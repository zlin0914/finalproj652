---
title: "About the data"
description: |
#author:
#  - name: Nora Jones 
#    url: https://example.com/norajones
#   affiliation: Spacely Sprockets
#   affiliation_url: https://example.com/spacelysprokets
#   date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Variables 
Columns:
- Date: Date of occurrence in datetime format (time is default 00:00:00.000Z)
- StateOfOccurrence: Country of occurrence
- Location: City or nearest city of occurrence
- Model: Aircraft type
- Registration: Aircraft registration code
- Operator: Name of Operator (airline, institution or responsible for the aircraft operation)
- StateOfOperator: Operator's country
- StateOfRegistry: Country of aircraft registration
- FlightPhase: Flight Phase of occurrence (take off, landing, approach, etc.)
- Class: Accident (unique value). rmk: only 'Accident' class was selected in this dataset (no incidens)
- Fatalities: Number of fatal victims
- Over2250: If aircraft basic operational weight (empty) is greater than 2250KG
- Over5700: If aircraft basic operational weight (empty) is greater than 5700KG
- ScheduledCommercial: If it was a scheduled commercial flight (airlines mostly)
- InjuryLevel: Level of injuries on person/people involved in the occurrence
- TypeDesignator: Aircraft type code (https://cfapps.icao.int/doc8643/reports/Part2-By%20Type%20Designator(Decode).pdf)
- Helicopter: if it was a helicopter
- Airplane: If it was an airplane
- Engine: Number of engines in the aircraft
- EngineType: Aircraft engine type (jet, turboprop or piston)
- Official: If ICAO was designated to participate in the accident investigation
- OccCats: All risk types involved in the occurrence, coded according to HRCs ( High Risks Categories codes) - ICAO
- Risk: Main risk type involved in the occurrence, coded according to HRCs(( High Risks Categories codes) - ICAO
- Year: Year of occurrence

## Data Preparation
Here are the packages I used for this data visualization:

```{r dataprep, echo= TRUE, eval=TRUE}
library(dplyr)
library(tidyverse)
```

Read the data and clean it ready to use:
```{r importdata, echo=TRUE, eval=TRUE}
df<-read.csv("data/ICAO_accidents.csv") 
```

We are only looking at the accidents of comercial flights:
```{r echo=TRUE, eval=TRUE}
df <- filter(df, df$ScheduledCommercial == "True")
```


```{r echo=TRUE, eval=TRUE}
df_full<- df %>% group_by(Year) %>% mutate(num_fatal = sum(Fatalities, na.rm = T))
```


# Number case year each Phase
phase_year<- data.frame(table(df$Year, df$FlightPhase))

#
num_fatal_year<- data.frame(table(df$Year, df$Fatalities))
ggplot(df, aes( x= year, y = num_fatal)) 

west <- c("CA", "OR", "WA")
west_coast <- ggplot(df) +
              geom_line(aes(year, num_fatal, colour = FlightPhase)) + 
#              gghighlight(state %in% west) +
              labs(x = "Year", y = "Total Production of Honey") 
west_coast

#Number case year each Injured Level
phase_inj<- data.frame(table(df$Year, df$InjuryLevel))


df_a<- df %>% group_by(Year) %>% mutate(num_fatal = sum(Fatalities, na.rm = T))

ggplot(year, aes( x= year, y = num_fatal)) + geom_point()

year_crashes <- data.frame(table(as.factor(format(df$Year)))) %>%  
                  rename(Year = Var1, Number_of_Acci  = Freq ) 
df_y <- data.frame(year_crashes)

df <- left_join(year_crashes, df)
#Number of Accident
ggplot(year_crashes, aes( x = year, y = Number_of_Acci, group = 1)) + 
  geom_line() + geom_point() + geom_smooth() 

#Number of Accident and Fatalities
ggplot(df, aes(x = Year, y = Fatalities)) + 
  geom_col(fill = FlightPhase) 

#Number of Crash Per month


#Injury Level Fatalities facet~Flight Phase
ggplot(df, aes(x = InjuryLevel, y = Fatalities)) +  geom_col(aes (fill = EngineType)) + facet_wrap(~FlightPhase)

#Year and Fatalities
ggplot(df,aes(Year, Fatalities)) + geom_point(aes(color = FlightPhase)) + geom_smooth()



#Most fatal in the what kind of phase?

df %>% drop_na(FlightPhase) %>% data.frame(table(as.numeric(format(FlightPhase)))) %>%  
                  rename(year = Var1, Number_of_Acci  = Freq ) 


```








