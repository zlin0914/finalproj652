---
title: "About the data"
description: |
#author:
#  - name: Nora Jones 
#    url: https://example.com/norajones
#   affiliation: Spacely Sprockets
#   affiliation_url: https://example.com/spacelysprokets
#   date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Variables 
Columns:

- Date: Date of occurrence in datetime format (time is default 00:00:00.000Z) 
- StateOfOccurrence: Country of occurrence 
- Location: City or nearest city of occurrence
- Model: Aircraft type
- Registration: Aircraft registration code 
- Operator: Name of Operator (airline, institution or responsible for the aircraft operation) 
- StateOfOperator: Operator's country
- StateOfRegistry: Country of aircraft registration 
- FlightPhase: Flight Phase of occurrence (take off, landing, approach, etc.)
- Class: Accident (unique value). rmk: only 'Accident' class was selected in this dataset (no incidens)
- Fatalities: Number of fatal victims
- Over2250: If aircraft basic operational weight (empty) is greater than 2250KG
- Over5700: If aircraft basic operational weight (empty) is greater than 5700KG
- ScheduledCommercial: If it was a scheduled commercial flight (airlines mostly)
- InjuryLevel: Level of injuries on person/people involved in the occurrence
- TypeDesignator: Aircraft type code (https://cfapps.icao.int/doc8643/reports/Part2-By%20Type%20Designator(Decode).pdf)
- Helicopter: if it was a helicopter
- Airplane: If it was an airplane
- Engine: Number of engines in the aircraft
- EngineType: Aircraft engine type (jet, turboprop or piston)
- Official: If ICAO was designated to participate in the accident investigation
- OccCats: All risk types involved in the occurrence, coded according to HRCs ( High Risks Categories codes) - ICAO
- Risk: Main risk type involved in the occurrence, coded according to HRCs(( High Risks Categories codes) - ICAO
- Year: Year of occurrence

## Data Preparation
Here are the packages I used for this data visualization:

```{r dataprep, echo= TRUE, eval=TRUE}
library(dplyr)
library(tidyverse)
library(knitr)
```

Read the data:

```{r importdata, echo=TRUE, eval=TRUE}
df<-read.csv("data/ICAO_accidents.csv") 

#Country abbreviation to country full name
world <- read.csv("data/world.csv") %>% 
    rename(StateOfOccurrence = Abbreviation)
df <- left_join(df, world)
```

We are only looking at the accidents of **commercial** flights:

```{r echo=TRUE, eval=TRUE}
com <- filter(df, df$ScheduledCommercial == "True") %>% select(Year, Country, Model, Fatalities, Over2250, Over5700, InjuryLevel, Risk, FlightPhase, EngineType)
kable(head(com[1:4,]))
```

Add up the fatality number for each year for each country:

```{r echo=TRUE, eval=TRUE}
coun<- com %>% group_by(Country, na.rm = T) %>% mutate(num_fatal = sum(Fatalities, na.rm = T))
```

Add up the fatality number for each year for each Flight Phase:

```{r echo=TRUE, eval=TRUE}
FP <- com %>% group_by(FlightPhase, na.rm = T) %>% mutate(num_fatal = sum(Fatalities, na.rm = T))
```





